---
- name: Infrahub lookup
  gather_facts: no
  hosts: localhost
  vars:
    ansible_python_interpreter: /Users/bkohler/.pyenv/versions/3.11.4/envs/infrahub-3.11/bin/python

  tasks:
    - name: SET FACT OF STRING
      set_fact:
        query_string: |
          query {
            location {
              id
              name
            }
          }

    - name: Obtain list of sites from Infrahub
      set_fact:
        query_response: "{{ query('infrahub.infrahub.lookup', query=query_string) }}"
    
    - name: Print result
      debug:
        msg: "{{ query_response }}"